# Stablecoin Pool Optimization Admin UI - Development Plan (Updated for Next.js)

## Overview

This document provides a comprehensive development plan for implementing the admin web interface for the Stablecoin Pool Optimization system using **Next.js**. The plan is organized into phases with clear deliverables, dependencies, and implementation details. 

**üö® IMPORTANT UPDATE**: This plan has been updated to reflect the migration from React Router v7 to Next.js while maintaining all existing functionality and UI/UX design.

## Migration Summary

### Framework Change
- **Previous**: React Router v7 (formerly Remix)
- **New**: Next.js 14+ with App Router
- **Reason**: Team familiarity with Next.js ecosystem and better community support
- **Approach**: Maintain exact same UI/UX design and component structure

### Migration Timeline
- **Duration**: 5 weeks for migration
- **Overlap**: Migration will run parallel to existing development phases
- **Impact**: Minimal disruption to ongoing development

## Development Phases

### Phase 0: Pipeline Integration (Week 0.5) ‚úÖ **COMPLETED**

#### 0.1 Pipeline Modification for Default Parameters ‚úÖ **COMPLETED**
**Tasks:**
- Modify asset allocation pipeline to read from default_allocation_parameters
- Update create_allocation_snapshots.py to use defaults when no run exists
- Modify fetch_allocation_parameters() in optimize_allocations.py to read defaults first
- Implement parameter override logic for custom runs
- Add logging for parameter source tracking

**Deliverables:**
- Modified create_allocation_snapshots.py to read from default_allocation_parameters
- Updated fetch_allocation_parameters() in optimize_allocations.py
- Pipeline changes to use defaults when no run exists
- Parameter override functionality for custom runs
- Logging for parameter source tracking

**Dependencies:**
- Database schema implementation
- Access to asset allocation codebase

#### 0.2 Database Migration for Defaults ‚úÖ **COMPLETED**
**Tasks:**
- Create migration script for default_allocation_parameters table
- Populate table with initial default values
- Test parameter retrieval in pipeline
- Update database documentation

**Deliverables:**
- Migration script
- Default parameter data
- Updated documentation

**Dependencies:**
- Database access permissions

### Phase 1: Next.js Migration Foundation (Week 1-2)

#### 1.1 Project Migration Setup ‚úÖ **COMPLETED**
**Tasks:**
- Initialize new Next.js project with App Router
- Configure development environment for Next.js
- Set up version control with migration branch
- Create migration project structure
- Backup existing React Router codebase

**Deliverables:**
- Next.js application structure
- Development environment configuration
- Git repository with migration strategy
- Backup of existing codebase

**Dependencies:**
- Node.js 18+
- npm/yarn package manager
- Git

#### 1.2 Core Dependencies Migration ‚úÖ **COMPLETED**
**Tasks:**
- Remove React Router dependencies
- Install Next.js specific packages
- Update Prisma for Next.js compatibility
- Migrate Clerk to @clerk/nextjs
- Set up Tailwind CSS for Next.js
- Configure TypeScript for Next.js

**Deliverables:**
- Updated package.json with Next.js dependencies
- Next.js configuration files
- Tailwind CSS configuration
- TypeScript configuration

**Dependencies:**
- Phase 1.1 completion
- Database credentials
- Clerk API keys

#### 1.3 Authentication System Migration ‚úÖ **COMPLETED**
**Tasks:**
- Migrate from @clerk/clerk-react to @clerk/nextjs
- Implement Next.js middleware for authentication
- Convert ProtectedRoute component to Next.js patterns
- Update authentication flow for App Router
- Implement server-side auth checks

**Deliverables:**
- Working Next.js authentication system
- Middleware configuration
- Protected route implementation
- Session management

**Dependencies:**
- Phase 1.2 completion
- Clerk configuration

### Phase 2: Routing & Layout Migration (Week 2-3)

#### 2.1 Routing Structure Conversion ‚úÖ **COMPLETED**
**Tasks:**
- Convert React Router routes to Next.js App Router
- Migrate dynamic routes ($param ‚Üí [param])
- Implement nested layouts
- Set up route groups for organization
- Update navigation components

**Deliverables:**
- Next.js App Router structure
- Migrated routes
- Layout system
- Navigation components

**Dependencies:**
- Phase 1.3 completion

#### 2.2 Layout Components Migration ‚úÖ **COMPLETED**
**Tasks:**
- Convert DashboardLayout to Next.js layout pattern
- Implement root layout with providers
- Create nested layouts for sections
- Migrate responsive design patterns
- Implement loading states with Next.js patterns

**Deliverables:**
- Next.js layout components
- Navigation system
- Responsive design foundation
- Loading states

**Dependencies:**
- Phase 2.1 completion

#### 2.3 Common UI Components Migration üîÑ **PARTIALLY COMPLETED**
**Tasks:**
- ‚úÖ Migrate Shadcn/ui components to Next.js
- ‚úÖ Update custom data table component
- ‚ö†Ô∏è Implement modal system for Next.js
- ‚ùå Create form validation utilities
- ‚ùå Set up notification system

**Deliverables:**
- ‚úÖ Component library
- ‚ùå Form validation system
- ‚ùå Notification framework
- ‚úÖ Updated UI components

**Dependencies:**
- Phase 2.2 completion

### Phase 3: Data Layer Migration (Week 3-4)

#### 3.1 Database Integration Migration ‚úÖ **COMPLETED**
**Tasks:**
- Migrate Prisma client setup for Next.js
- Update database connection for Next.js environment
- Implement proper connection pooling
- Set up database middleware if needed
- Test database operations

**Deliverables:**
- Next.js database integration
- Prisma configuration
- Connection optimization
- Database testing

**Dependencies:**
- Phase 2.3 completion

#### 3.2 API Routes Migration ‚ùå **NOT STARTED**
**Tasks:**
- Convert Remix loaders to Next.js Server Components
- Implement Next.js API routes
- Migrate form submissions to route handlers
- Set up proper error handling
- Implement caching strategies

**Deliverables:**
- Next.js API endpoints
- Server Components
- Route handlers
- Error handling

**Dependencies:**
- Phase 3.1 completion

#### 3.3 Data Fetching Patterns ‚ùå **NOT STARTED**
**Tasks:**
- Convert client-side data fetching
- Implement Next.js data fetching patterns
- Set up proper caching strategies
- Update data transformation utilities
- Implement real-time updates

**Deliverables:**
- Data loading strategies
- Caching implementation
- Data utilities
- Real-time features

**Dependencies:**
- Phase 3.2 completion

### Phase 4: Feature Implementation (Week 4-8)

#### 4.1 Dashboard Implementation (Week 4) üîÑ **PARTIALLY COMPLETED**
**Tasks:**
- ‚úÖ Migrate dashboard data layer to Next.js
- ‚úÖ Implement dashboard UI components
- ‚úÖ Create metric cards component
- ‚ùå Build chart components for visualizations
- ‚úÖ Assemble dashboard page

**Deliverables:**
- ‚úÖ Complete dashboard page
- ‚úÖ Dashboard UI components
- ‚ùå Chart visualizations
- ‚úÖ Interactive elements

**Dependencies:**
- Phase 3.3 completion

#### 4.2 Optimization History (Week 5) üîÑ **PARTIALLY COMPLETED**
**Tasks:**
- ‚úÖ Migrate optimization runs list
- ‚úÖ Implement single optimization run page
- ‚ùå Add export & search features
- ‚ùå Create pagination logic
- ‚ùå Implement filtering capabilities

**Deliverables:**
- ‚ùå Optimization runs API
- ‚úÖ Detailed optimization run page
- ‚ùå Export functionality
- ‚ùå Search and filter features

**Dependencies:**
- Phase 4.1 completion

#### 4.3 Pool Management (Week 6) üîÑ **PARTIALLY COMPLETED**
**Tasks:**
- ‚úÖ Migrate pools list page
- ‚úÖ Implement pool metrics page
- ‚úÖ Create single pool details
- ‚ùå Add protocol filtering
- ‚ùå Implement advanced filtering system

**Deliverables:**
- ‚úÖ Pools list page
- ‚úÖ Pool metrics page
- ‚úÖ Single pool page
- ‚ùå Filtering system

**Dependencies:**
- Phase 4.2 completion

#### 4.4 Protocols & Tokens Management (Week 7) üîÑ **PARTIALLY COMPLETED**
**Tasks:**
- Migrate approved protocols management
- Implement token management
- Create blacklisted tokens management
- Add CRUD operations
- Implement address validation

**Deliverables:**
- Protocol management page
- Token management pages
- Blacklist management
- CRUD operations

**Dependencies:**
- Phase 4.3 completion

#### 4.5 Configuration Management (Week 8) üîÑ **PARTIALLY COMPLETED**
**Tasks:**
- ‚ùå Migrate configuration API
- ‚úÖ Implement configuration UI
- ‚ö†Ô∏è Create wallet management
- ‚ùå Add parameter validation
- ‚ùå Implement save/reset functionality

**Deliverables:**
- ‚ùå Configuration API
- ‚úÖ Configuration management page
- ‚ö†Ô∏è Wallet management interface
- ‚ùå Form validation

**Dependencies:**
- Phase 4.4 completion

### Phase 5: Testing & Deployment (Week 9-10)

#### 5.1 Migration Testing (Week 9) ‚ùå **NOT STARTED**
**Tasks:**
- Test all migrated routes and functionality
- Validate authentication flow
- Test database connections
- Performance testing
- Cross-browser compatibility testing

**Deliverables:**
- Test suite
- Migration validation
- Performance benchmarks
- Compatibility report

**Dependencies:**
- Phase 4.5 completion

#### 5.2 Performance Optimization (Week 10) ‚ùå **NOT STARTED**
**Tasks:**
- Implement Next.js image optimization
- Set up proper caching headers
- Optimize bundle size
- Configure build optimizations
- Implement code splitting

**Deliverables:**
- Optimized application
- Improved performance metrics
- Caching implementation
- Build optimization

**Dependencies:**
- Phase 5.1 completion

#### 5.3 Deployment Setup (Week 10) ‚ùå **NOT STARTED**
**Tasks:**
- Configure GCP Cloud Run for Next.js
- Set up CI/CD pipeline for Next.js
- Implement environment configurations
- Create deployment documentation
- Migrate production environment

**Deliverables:**
- Deployed Next.js application
- CI/CD pipeline
- Deployment documentation
- Production migration

**Dependencies:**
- Phase 5.2 completion

## Current Completion Status Summary

### Overall Progress: ~60% Complete

**Phase Completion Breakdown:**
- ‚úÖ **Phase 0**: Pipeline Integration - **100% Complete**
- ‚úÖ **Phase 1**: Next.js Migration Foundation - **100% Complete**  
- ‚úÖ **Phase 2**: Routing & Layout Migration - **100% Complete**
- üîÑ **Phase 3**: Data Layer Migration - **33% Complete** (Database done, API/Data Fetching missing)
- üîÑ **Phase 4**: Feature Implementation - **40% Complete** (UI structure done, data integration partially complete)
- ‚ùå **Phase 5**: Testing & Deployment - **0% Complete** (Not started)

### Key Achievements ‚úÖ
- Successfully migrated from React Router to Next.js 14 with App Router
- Complete authentication system with Clerk integration
- Full UI component library with Shadcn/ui
- Responsive layout system with navigation
- Database schema and migrations completed
- Basic page structures for all features implemented

### Critical Next Steps üö®
1. **Implement API Routes** - Create Next.js API endpoints in `web-ui/src/app/api/`
2. **Add Data Integration** - Connect UI components to actual data sources
3. **Complete CRUD Operations** - Implement create, read, update, delete operations
4. **Add Chart Components** - Implement data visualizations for dashboard
5. **Implement Form Validation** - Add validation utilities and error handling
6. **Set Up Testing** - Create test suite and validation

### Immediate Priorities (Next 1-2 weeks)
1. Phase 3.2: API Routes Migration
2. Phase 3.3: Data Fetching Patterns  
3. Phase 4.1-4.5: Complete data integration for all features

### Medium-term Priorities (Next 2-4 weeks)
1. Complete remaining Phase 4 features (CRUD, validation, charts)
2. Begin Phase 5: Testing & Deployment

---

## Technical Implementation Details

### Next.js Project Structure

```
web-ui-nextjs/
‚îú‚îÄ‚îÄ app/                          # Next.js App Router
‚îÇ   ‚îú‚îÄ‚îÄ (auth)/                   # Route group for auth pages
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ login/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ signup/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx
‚îÇ   ‚îú‚îÄ‚îÄ (dashboard)/               # Route group for dashboard
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx           # Dashboard layout
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx             # Dashboard home
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ optimization/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx         # Optimization runs list
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [runId]/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx     # Single run details
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pools/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ page.tsx         # Pools list
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ [poolId]/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx     # Single pool details
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ metrics/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx     # Pool metrics
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ protocols/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ page.tsx         # Protocols management
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ page.tsx         # Configuration management
‚îÇ   ‚îú‚îÄ‚îÄ api/                     # Next.js API routes
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dashboard/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts         # Dashboard metrics
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ optimization/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ runs/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts     # Optimization runs
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [runId]/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ route.ts     # Single run details
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pools/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ list/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts     # Pools list
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ metrics/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts     # Pool metrics
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ [poolId]/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ route.ts     # Single pool details
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ protocols/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ approved/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts     # Approved protocols
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tokens/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ route.ts     # Approved tokens
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ blacklisted/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ route.ts     # Blacklisted tokens
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ parameters/
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ route.ts     # Configuration parameters
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ wallets/
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ route.ts       # Wallet addresses
‚îÇ   ‚îú‚îÄ‚îÄ globals.css              # Global styles
‚îÇ   ‚îú‚îÄ‚îÄ layout.tsx              # Root layout
‚îÇ   ‚îú‚îÄ‚îÄ loading.tsx             # Root loading
‚îÇ   ‚îú‚îÄ‚îÄ error.tsx              # Root error boundary
‚îÇ   ‚îî‚îÄ‚îÄ not-found.tsx          # 404 page
‚îú‚îÄ‚îÄ components/                 # Reusable components
‚îÇ   ‚îú‚îÄ‚îÄ ui/                   # Shadcn/ui components
‚îÇ   ‚îú‚îÄ‚îÄ charts/               # Chart components
‚îÇ   ‚îú‚îÄ‚îÄ forms/                # Form components
‚îÇ   ‚îú‚îÄ‚îÄ tables/               # Table components
‚îÇ   ‚îî‚îÄ‚îÄ layout/               # Layout components
‚îú‚îÄ‚îÄ lib/                      # Utility libraries
‚îÇ   ‚îú‚îÄ‚îÄ db.ts                 # Database connection
‚îÇ   ‚îú‚îÄ‚îÄ auth.ts               # Authentication utilities
‚îÇ   ‚îú‚îÄ‚îÄ utils.ts              # General utilities
‚îÇ   ‚îî‚îÄ‚îÄ validations.ts        # Form validations
‚îú‚îÄ‚îÄ prisma/                   # Database
‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma         # Database schema
‚îÇ   ‚îî‚îÄ‚îÄ migrations/           # Database migrations
‚îú‚îÄ‚îÄ public/                   # Static assets
‚îú‚îÄ‚îÄ middleware.ts             # Next.js middleware
‚îú‚îÄ‚îÄ next.config.js           # Next.js configuration
‚îú‚îÄ‚îÄ tailwind.config.js       # Tailwind configuration
‚îú‚îÄ‚îÄ tsconfig.json           # TypeScript configuration
‚îî‚îÄ‚îÄ package.json            # Dependencies and scripts
```

### Database Schema Implementation

#### New Tables Required:

1. **default_allocation_parameters**
```sql
CREATE TABLE default_allocation_parameters (
    id SERIAL PRIMARY KEY,
    parameter_name VARCHAR(255) UNIQUE NOT NULL,
    parameter_value JSONB NOT NULL,
    description TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP
);
```

2. **allocation_parameters** (Enhancement)
```sql
ALTER TABLE allocation_parameters ADD COLUMN projected_apy DECIMAL(20, 4);
ALTER TABLE allocation_parameters ADD COLUMN transaction_costs DECIMAL(20, 2);
ALTER TABLE allocation_parameters ADD COLUMN transaction_sequence JSONB;
```

#### Database Views:
```sql
CREATE VIEW pool_metrics_extended AS
SELECT 
    p.*,
    pdm.actual_apy,
    pdm.forecasted_apy,
    pdm.actual_tvl,
    pdm.forecasted_tvl,
    pdm.date,
    pdm.is_filtered_out,
    pdm.filter_reason
FROM pools p
JOIN pool_daily_metrics pdm ON p.pool_id = pdm.pool_id;
```

### API Routes Structure (Next.js)

```
app/api/
‚îú‚îÄ‚îÄ dashboard/route.ts          # Dashboard metrics
‚îú‚îÄ‚îÄ optimization/
‚îÇ   ‚îú‚îÄ‚îÄ runs/route.ts          # Optimization runs list
‚îÇ   ‚îî‚îÄ‚îÄ [runId]/route.ts      # Single run details
‚îú‚îÄ‚îÄ pools/
‚îÇ   ‚îú‚îÄ‚îÄ list/route.ts          # Pools list
‚îÇ   ‚îú‚îÄ‚îÄ metrics/route.ts        # Pool metrics
‚îÇ   ‚îî‚îÄ‚îÄ [poolId]/route.ts     # Single pool details
‚îú‚îÄ‚îÄ protocols/
‚îÇ   ‚îú‚îÄ‚îÄ approved/route.ts       # Approved protocols
‚îÇ   ‚îú‚îÄ‚îÄ tokens/route.ts         # Approved tokens
‚îÇ   ‚îî‚îÄ‚îÄ blacklisted/route.ts    # Blacklisted tokens
‚îî‚îÄ‚îÄ config/
    ‚îú‚îÄ‚îÄ parameters/route.ts     # Configuration parameters
    ‚îî‚îÄ‚îÄ wallets/route.ts       # Wallet addresses
```

### Component Architecture

```
components/
‚îú‚îÄ‚îÄ ui/                 # Shadcn/ui components
‚îú‚îÄ‚îÄ charts/             # Chart components
‚îÇ   ‚îú‚îÄ‚îÄ LineChart.tsx
‚îÇ   ‚îú‚îÄ‚îÄ PieChart.tsx
‚îÇ   ‚îî‚îÄ‚îÄ BarChart.tsx
‚îú‚îÄ‚îÄ forms/              # Form components
‚îÇ   ‚îú‚îÄ‚îÄ ProtocolForm.tsx
‚îÇ   ‚îú‚îÄ‚îÄ TokenForm.tsx
‚îÇ   ‚îî‚îÄ‚îÄ ConfigForm.tsx
‚îú‚îÄ‚îÄ tables/             # Table components
‚îÇ   ‚îú‚îÄ‚îÄ DataTable.tsx
‚îÇ   ‚îú‚îÄ‚îÄ PoolTable.tsx
‚îÇ   ‚îî‚îÄ‚îÄ OptimizationTable.tsx
‚îî‚îÄ‚îÄ layout/             # Layout components
    ‚îú‚îÄ‚îÄ Header.tsx
    ‚îú‚îÄ‚îÄ Sidebar.tsx
    ‚îî‚îÄ‚îÄ Layout.tsx
```

## Migration Mapping

### Route Mapping
| React Router v7 | Next.js App Router |
|----------------|-------------------|
| `app/routes/_index.tsx` | `app/(dashboard)/page.tsx` |
| `app/routes/login.tsx` | `app/(auth)/login/page.tsx` |
| `app/routes/optimization/_index.tsx` | `app/(dashboard)/optimization/page.tsx` |
| `app/routes/optimization/$runId.tsx` | `app/(dashboard)/optimization/[runId]/page.tsx` |
| `app/routes/pools/_index.tsx` | `app/(dashboard)/pools/page.tsx` |
| `app/routes/pools/$poolId.tsx` | `app/(dashboard)/pools/[poolId]/page.tsx` |
| `app/routes/pools/metrics.tsx` | `app/(dashboard)/pools/metrics/page.tsx` |
| `app/routes/protocols/_index.tsx` | `app/(dashboard)/protocols/page.tsx` |
| `app/routes/config/_index.tsx` | `app/(dashboard)/config/page.tsx` |

### Component Migration
| React Router Pattern | Next.js Pattern |
|-------------------|-----------------|
| Remix loaders | Server Components / getServerSideProps |
| Remix actions | Route handlers (POST/PUT/DELETE) |
| useLoaderData | Direct data fetching in Server Components |
| useActionData | Form handling with Next.js patterns |
| Outlet | Children prop in layouts |

### Authentication Migration
| React Router v7 | Next.js |
|----------------|---------|
| `<ClerkProvider>` | `<ClerkProvider>` (same) |
| `ProtectedRoute` component | Middleware + Layout patterns |
| `useUser()` hook | `useUser()` hook (same) |
| Route-based protection | Middleware-based protection |

## Development Guidelines

### Code Standards
- TypeScript for type safety
- ESLint + Prettier for code formatting
- Conventional commits for version control
- Component-driven development
- Server/Client component separation

### Testing Strategy
- Unit tests with Jest + React Testing Library
- Integration tests for API routes
- E2E tests with Playwright
- Minimum 80% code coverage
- Migration-specific testing

### Performance Considerations
- Implement proper indexing on database queries
- Use React.memo for component optimization
- Implement virtual scrolling for large tables
- Optimize bundle size with Next.js code splitting
- Leverage Next.js caching mechanisms

### Security Measures
- Input validation on all forms
- SQL injection prevention through Prisma
- XSS protection through React
- CSRF protection through Next.js
- Rate limiting on API endpoints
- Middleware-based authentication

## Migration Risk Assessment

### High Risks
1. **Authentication Flow Changes**: Clerk integration differences
   - Mitigation: Thorough testing of auth flows
   
2. **Server Component Boundaries**: Proper separation of client/server code
   - Mitigation: Careful component architecture planning

### Medium Risks
1. **Build Process Changes**: Different build optimization
   - Mitigation: Performance testing and optimization
   
2. **Environment Variables**: Different handling in Next.js
   - Mitigation: Comprehensive environment setup

### Low Risks
1. **Styling Issues**: Minor CSS differences
   - Mitigation: Visual testing and adjustments
   
2. **Import Path Changes**: File structure differences
   - Mitigation: Systematic path updates

## Post-Migration Benefits

1. **Better Community Support**: Larger Next.js ecosystem
2. **Improved Performance**: Next.js optimizations
3. **Enhanced Developer Experience**: Better tooling
4. **Future-Proof**: Active development and updates
5. **Deployment Flexibility**: Multiple deployment options
6. **Built-in Features**: Image optimization, internationalization, edge functions

## Success Metrics

### Performance Metrics
- Page load time < 2 seconds
- API response time < 500ms
- 99.9% uptime
- Mobile responsiveness score > 95

### Quality Metrics
- Test coverage > 80%
- Zero critical security vulnerabilities
- Accessibility score > 90
- User satisfaction > 4.5/5

### Migration Success Metrics
- All existing functionality preserved
- Identical UI/UX design maintained
- Performance improved or maintained
- Zero data loss during migration
- Team comfortable with new stack

## Deployment Strategy

### Environment Setup
1. **Development**: Local development with Next.js dev server
2. **Staging**: GCP Cloud Run with test database
3. **Production**: GCP Cloud Run with production database

### CI/CD Pipeline
1. **Code Quality**: Automated linting and testing
2. **Build**: Next.js build and optimization
3. **Deploy**: Automated deployment to staging
4. **Release**: Manual promotion to production

### Migration Deployment
1. **Parallel Deployment**: Run both versions during migration
2. **Feature Flags**: Gradual rollout of Next.js features
3. **Database Migration**: Zero-downtime database migration
4. **DNS Switch**: Seamless transition to Next.js

## Resource Requirements

### Development Team
- 1 Full-stack developer (Next.js/React/TypeScript)
- 0.5 Database specialist (for optimization)
- 0.5 UI/UX designer (for design refinement)
- 0.5 DevOps engineer (for migration deployment)

### Infrastructure
- GCP Cloud Run for hosting (Next.js optimized)
- GCP Cloud SQL (existing)
- GCP Cloud Storage for assets
- Monitoring and logging tools

### Timeline
- **Migration Duration**: 5 weeks
- **Parallel Development**: Ongoing feature development continues
- **Total Duration**: 10 weeks (migration + remaining features)
- **MVP Delivery**: Week 5 (migration complete)
- **Full Release**: Week 10 (all features complete)
- **Post-launch support**: Ongoing

## Conclusion

This updated development plan provides a structured approach to migrating the admin UI from React Router v7 to Next.js while ensuring quality, performance, and security throughout the migration process. The phased approach minimizes risk and allows for thorough testing at each stage while maintaining all existing functionality and design.

The migration to Next.js will provide better community support, improved performance, and enhanced developer experience while preserving the exact same UI/UX design that users are familiar with.